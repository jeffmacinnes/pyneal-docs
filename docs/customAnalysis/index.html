
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.3">
    
    
      
        <title>Customized Analyses - Pyneal Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#customized-analyses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Pyneal Docs" class="md-header-nav__button md-logo" aria-label="Pyneal Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Pyneal Docs
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Customized Analyses
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pyneal Docs" class="md-nav__button md-logo" aria-label="Pyneal Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Pyneal Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../setup/" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Overview
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../dataflow/" class="md-nav__link">
      Data Flow
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../pynealScanner/" class="md-nav__link">
      Pyneal Scanner
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../pyneal/" class="md-nav__link">
      Pyneal
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../endUser/" class="md-nav__link">
      End User
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../simulations/" class="md-nav__link">
      Simulations
    </a>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Additional Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Additional Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Additional Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../createMask/" class="md-nav__link">
      Creating Masks
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Customized Analyses
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Customized Analyses
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#custom-analysis-script" class="md-nav__link">
    Custom Analysis Script
  </a>
  
    <nav class="md-nav" aria-label="Custom Analysis Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__-initialize" class="md-nav__link">
    __init__ (initialize)
  </a>
  
    <nav class="md-nav" aria-label="__init__ (initialize)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preset-variables-and-creating-new-ones" class="md-nav__link">
    Preset variables, and creating new ones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-log-messages" class="md-nav__link">
    Adding log messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-specified-__init__-code" class="md-nav__link">
    User-specified __init__ code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute" class="md-nav__link">
    compute
  </a>
  
    <nav class="md-nav" aria-label="compute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-specified-compute-code" class="md-nav__link">
    User-specified compute code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-results" class="md-nav__link">
    Storing results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../troubleshooting/" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    
    <label class="md-nav__link" for="nav-7">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../glossary/" class="md-nav__link">
      Glossary
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../imageOrientation/" class="md-nav__link">
      Image Orientation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#custom-analysis-script" class="md-nav__link">
    Custom Analysis Script
  </a>
  
    <nav class="md-nav" aria-label="Custom Analysis Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__init__-initialize" class="md-nav__link">
    __init__ (initialize)
  </a>
  
    <nav class="md-nav" aria-label="__init__ (initialize)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preset-variables-and-creating-new-ones" class="md-nav__link">
    Preset variables, and creating new ones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-log-messages" class="md-nav__link">
    Adding log messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-specified-__init__-code" class="md-nav__link">
    User-specified __init__ code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute" class="md-nav__link">
    compute
  </a>
  
    <nav class="md-nav" aria-label="compute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-specified-compute-code" class="md-nav__link">
    User-specified compute code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-results" class="md-nav__link">
    Storing results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="customized-analyses">Customized Analyses<a class="headerlink" href="#customized-analyses" title="Permanent link">&para;</a></h1>
<p>One of <strong>Pyneal's</strong> most powerful features is its ability to run customized analyses during a real-time scan. This means you can design your own analyses to fit your unique experimental needs, and <strong>Pyneal</strong> will execute those analyses on every new timepoint and store the results. </p>
<p>To take advantage of this feature, you write a custom analysis script (in <code>python</code>), and select the <code>Custom</code> button in the Analysis pane of the GUI:</p>
<p><img alt="" src="../images/customAnalysis/customAnalysis_GUI.png" /></p>
<h2 id="custom-analysis-script">Custom Analysis Script<a class="headerlink" href="#custom-analysis-script" title="Permanent link">&para;</a></h2>
<p>While custom analyses offer a lot of flexibility, there are a couple of important constraints that need to be included in the script to ensure it can be integrated into the typical <strong>Pyneal</strong> data flow. </p>
<p>The best way to ensure these constraints are met is to base your script off of the template file included with <strong>Pyneal</strong>. You can find this template in </p>
<p><code>pyneal/utils/customAnalyses/customAnalysisTemplate.py</code></p>
<p>Or, you can simply copy the text here:</p>
<pre><code class="language-python">import sys
import os
from os.path import join
import logging

import numpy as np
import nibabel as nib


class CustomAnalysis:
    &quot;&quot;&quot; Custom Analysis Module

    This class contains all of the methods needed for setting up and executing
    customized analyses in Pyneal during a real-time scan

    &quot;&quot;&quot;
    def __init__(self, maskFile, weightMask, numTimepts):
        &quot;&quot;&quot; Initialize the class

        Everything in the `__init__` method will be executed BEFORE the scan
        begins. This is a place to run any necessary setup code.

        The `__init__` method provides a number of inputs from the setup GUI
        that can be used to help set up a customized analyses. You are free to
        use or ignore these inputs as needed.

        Parameters
        ----------
        maskFile : string
            full path to the mask file specified in the Pyneal setup GUI
        weightMask : boolean
            flag indicating whether the &quot;weight mask?&quot; option in setup GUI was
            checked.
        numTimepts : int
            number of timepts in the run, as specified in the setup GUI

        &quot;&quot;&quot;
        # Load masks and weights, and create an within-class reference to
        # each for use in later methods.
        mask_img = nib.load(maskFile)
        if weightMask is True:
            self.weights = mask_img.get_data().copy()
        self.mask = mask_img.get_data() &gt; 0  # 3D boolean array of mask voxels

        # within-class reference to numTimepts for use in later methods
        self.numTimepts = numTimepts

        # Add the directory that this script lives in to the path. This way it
        # is easy to load any additional files you want to put in the same
        # directory as your custom analysis script
        self.customAnalysisDir = os.path.abspath(os.path.dirname(__file__))
        sys.path.append(self.customAnalysisDir)

        # Import the logger. If desired, you can write log messages to the
        # Pyneal log file using:
        # self.logger.info('my log message') - log file and stdOut
        # self.logger.debug('my log message') - log file only
        self.logger = logging.getLogger('PynealLog')

        ########################################################################
        ############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
        self.myResult = 1


        ############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
        ########################################################################

    def compute(self, vol, volIdx):
        &quot;&quot;&quot; Compute method

        This method will be executed on EACH new 3D volume that arrives
        DURING the real-time scan. Results must be returned in a dictionary. No
        restrictions on dict key names or values, but note that the volume
        index will get added automatically by Pyneal before the result gets
        placed on the results server, so no need to specify that here

        Parameters
        ----------
        vol : numpy-array
            3D array of voxel data for the current volume
        volIdx : int
            0-based index indicating where, in time (4th dimension), the volume
            belongs

        Returns
        -------
        dict
            dictionary containing key:value pair(s) for the results for the
            current volume

        &quot;&quot;&quot;
        ########################################################################
        ############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
        self.myResult += 1


        ############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
        ########################################################################

        return {'result': self.myResult}
</code></pre>
<p>The script class consists of a single class (<code>CustomAnalysis</code>) with two methods: <code>__init__</code> and <code>compute</code>. You are welcome to include any additional methods that are useful, just make sure these two methods exist. See below for details on what each method does and how to customize them. </p>
<h3 id="__init__-initialize"><code>__init__</code> (initialize)<a class="headerlink" href="#__init__-initialize" title="Permanent link">&para;</a></h3>
<p>The <code>__init__</code> method is called as soon as you hit <code>submit</code> on the setup GUI. In other words, the code in this method runs <em>before</em> the scan begins. Thus, the <code>__init__</code> method is where you will specify any set up code that needs to be initialized before the scan begins (e.g. loading multiple mask files).</p>
<p>Let's take a look at the code in more detail:</p>
<pre><code class="language-python">def __init__(self, maskFile, weightMask, numTimepts):
    &quot;&quot;&quot; Initialize the class

    Everything in the `__init__` method will be executed BEFORE the scan
    begins. This is a place to run any necessary setup code.

    The `__init__` method provides a number of inputs from the setup GUI
    that can be used to help set up a customized analyses. You are free to
    use or ignore these inputs as needed.

    Parameters
    ----------
    maskFile : string
        full path to the mask file specified in the Pyneal setup GUI
    weightMask : boolean
        flag indicating whether the &quot;weight mask?&quot; option in setup GUI was
        checked.
    numTimepts : int
        number of timepts in the run, as specified in the setup GUI

    &quot;&quot;&quot;
    # Load masks and weights, and create an within-class reference to
    # each for use in later methods.
    mask_img = nib.load(maskFile)
    if weightMask is True:
        self.weights = mask_img.get_data().copy()
    self.mask = mask_img.get_data() &gt; 0  # 3D boolean array of mask voxels

    # within-class reference to numTimepts for use in later methods
    self.numTimepts = numTimepts

    # Add the directory that this script lives in to the path. This way it
    # is easy to load any additional files you want to put in the same
    # directory as your custom analysis script
    self.customAnalysisDir = os.path.abspath(os.path.dirname(__file__))
    sys.path.append(self.customAnalysisDir)

    # Import the logger. If desired, you can write log messages to the
    # Pyneal log file using:
    # self.logger.info('my log message') - log file and stdOut
    # self.logger.debug('my log message') - log file only
    self.logger = logging.getLogger('PynealLog')

    ########################################################################
    ############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
    self.myResult = 1


    ############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
    ########################################################################
</code></pre>
<h4 id="preset-variables-and-creating-new-ones">Preset variables, and creating new ones<a class="headerlink" href="#preset-variables-and-creating-new-ones" title="Permanent link">&para;</a></h4>
<p>First, note that certain settings from the setup GUI are passed into the custom analysis script. Namely:</p>
<ul>
<li><code>maskFile</code>: the path to the mask specified in the GUI</li>
<li><code>weightMask</code>: a True/False boolean flag indicating whether the <code>weight mask?</code> option was checked or not.</li>
<li><code>numTimepts</code>: the number of timepts in the run, as specified in the GUI. </li>
</ul>
<p>At the top of the <code>__init__</code> method, you'll see some code that reads in each of those settings, and creates local variables for each:</p>
<pre><code class="language-python"># Load masks and weights, and create an within-class reference to
# each for use in later methods.
mask_img = nib.load(maskFile)
if weightMask == True:
    self.weights = mask_img.get_data().copy()
self.mask = mask_img.get_data() &gt; 0  # 3D boolean array of mask voxels

# within-class reference to numTimepts for use in later methods
self.numTimepts = numTimepts
</code></pre>
<p>This enables you to reference these variables in any other method by referring to <code>self.mask</code>, <code>self.weights</code>, and <code>self.numTimepts</code>. In fact, the same thing is true for any variable you create in the <code>__init__</code> method; in order to access the variable in other methods, you must prepend the variable name with <code>self.</code></p>
<p>The <code>__init__</code> method also contains a couple of other useful tidbits near the top. First, we add the directory that contains your custom analysis script to the path. This way, you can easily load any additional files that are exist in that same directory. </p>
<pre><code class="language-python"># Add the directory that this script lives in to the path. This way it
# is easy to load any additional files you want to put in the same
# directory as your custom analysis script
self.customAnalysisDir = os.path.abspath(os.path.dirname(__file__))
sys.path.append(self.customAnalysisDir)
</code></pre>
<h4 id="adding-log-messages">Adding log messages<a class="headerlink" href="#adding-log-messages" title="Permanent link">&para;</a></h4>
<p>It also creates a reference to the logger, which is the tool that adds new messages to the <code>pynealLog.log</code> output file. You can use this reference anywhere in your script to add new log messages, which will be automatically timestamped and included in the output file. You can even control the type of log message</p>
<ul>
<li><strong>info</strong> messages will get written to the output file <strong><em>AND</em></strong> appear in the stdOut of the terminal</li>
<li><strong>debug</strong> messages will only get written to the output file</li>
</ul>
<pre><code class="language-python"># Import the logger. If desired, you can write log messages to the
# Pyneal log file using:
# self.logger.info('my log message') - log file and stdOut
# self.logger.debug('my log message') - log file only
self.logger = logging.getLogger('PynealLog')
</code></pre>
<h4 id="user-specified-__init__-code">User-specified <code>__init__</code> code<a class="headerlink" href="#user-specified-__init__-code" title="Permanent link">&para;</a></h4>
<p>Finally, at the bottom of the <code>__init__</code> method is space for you to include any additional code that is needed. </p>
<pre><code class="language-python">########################################################################
############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
self.myResult = 1



############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
########################################################################
</code></pre>
<p>In order to illustrate, in the example above we're simply creating a new variable (<code>self.myResult</code>) and assigning it a value of <code>1</code>.</p>
<h3 id="compute"><code>compute</code><a class="headerlink" href="#compute" title="Permanent link">&para;</a></h3>
<p>The <code>compute</code> method is what actually gets called during a scan. In fact, it gets called each time a new 3D volume appears from the scanner. Here's the code in more detail:</p>
<pre><code class="language-python">def compute(self, vol, volIdx):
    &quot;&quot;&quot; Compute method

    This method will be executed on EACH new 3D volume that arrives
    DURING the real-time scan. Results must be returned in a dictionary. No
    restrictions on dict key names or values, but note that the volume
    index will get added automatically by Pyneal before the result gets
    placed on the results server, so no need to specify that here

    Parameters
    ----------
    vol : numpy-array
        3D array of voxel data for the current volume
    volIdx : int
        0-based index indicating where, in time (4th dimension), the volume
        belongs

    Returns
    -------
    dict
        dictionary containing key:value pair(s) for the results for the
        current volume

    &quot;&quot;&quot;
    ########################################################################
    ############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
    self.myResult += 1


    ############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
    ########################################################################

    return {'result': self.myResult}
</code></pre>
<p>Note that the <code>compute</code> method passes in references to the current <code>volume</code> (3D numpy array, [x,y,z]), as well as the <code>volIdx</code>, an integer representing the current volume index (in 4th dimension; 0-based index). </p>
<h4 id="user-specified-compute-code">User-specified <code>compute</code> code<a class="headerlink" href="#user-specified-compute-code" title="Permanent link">&para;</a></h4>
<p>The <code>compute</code> method includes space for you to insert your own analysis code:</p>
<pre><code class="language-python">########################################################################
############# vvv INSERT USER-SPECIFIED CODE BELOW vvv #################
self.myResult += 1




############# ^^^ END USER-SPECIFIED CODE ^^^ ##########################
########################################################################

</code></pre>
<p>You can use this area to write customized analysis code that will be executed on each volume. In the simple example above, each time a new volume arrives, the <code>compute</code> method will increment the <code>self.myResult</code> variable (created in the <code>__init__</code> method) by 1.</p>
<h4 id="storing-results">Storing results<a class="headerlink" href="#storing-results" title="Permanent link">&para;</a></h4>
<p>The <code>compute</code> method must return a python dictionary containing the analysis result (or results) for the current volume. </p>
<pre><code class="language-python">return {'result': self.myResult}
</code></pre>
<p>That said, you are free to customize the contents of this dictionary as needed to fit your experimental needs. For instance, if you are calculating the mean signal in multiple ROIs (and storing those value in variables named <code>roi1_meanSignal</code>, <code>roi2_meanSignal</code>, and <code>roi3_meanSignal</code>) your dictionary could look something like this:</p>
<pre><code class="language-python">{'roi1_mean': roi1_meanSignal,
'roi2_mean`: roi2_meanSignal,
'roi3_mean`: roi3_meanSignal}
</code></pre>
<p><strong>Pyneal</strong> automatically tacks on the current <code>volIdx</code> as an entry to the dictionary later on, so no need to include that information here. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../createMask/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating Masks
              </div>
            </div>
          </a>
        
        
          <a href="../troubleshooting/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Troubleshooting
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/jeffmacinnes/pyneal" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>