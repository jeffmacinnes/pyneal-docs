
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.3">
    
    
      
        <title>Simulations - Pyneal Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#simulations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Pyneal Docs" class="md-header-nav__button md-logo" aria-label="Pyneal Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Pyneal Docs
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Simulations
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pyneal Docs" class="md-nav__button md-logo" aria-label="Pyneal Docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Pyneal Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../setup/" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Overview
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../dataflow/" class="md-nav__link">
      Data Flow
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../pynealScanner/" class="md-nav__link">
      Pyneal Scanner
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../pyneal/" class="md-nav__link">
      Pyneal
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../endUser/" class="md-nav__link">
      End User
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Simulations
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Simulations
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneal-scanner-simulation-tools" class="md-nav__link">
    Pyneal Scanner Simulation Tools
  </a>
  
    <nav class="md-nav" aria-label="Pyneal Scanner Simulation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scanner-simulators" class="md-nav__link">
    Scanner Simulators
  </a>
  
    <nav class="md-nav" aria-label="Scanner Simulators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ge" class="md-nav__link">
    GE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philips" class="md-nav__link">
    Philips
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siemens" class="md-nav__link">
    Siemens
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pynealreceiver_simpy" class="md-nav__link">
    pynealReceiver_sim.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneal-simulation-tools" class="md-nav__link">
    Pyneal Simulation Tools
  </a>
  
    <nav class="md-nav" aria-label="Pyneal Simulation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pynealscanner_simpy" class="md-nav__link">
    pynealScanner_sim.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pynealresults_simpy" class="md-nav__link">
    pynealResults_sim.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enduser_simpy" class="md-nav__link">
    endUser_sim.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    
    <label class="md-nav__link" for="nav-5">
      Additional Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Additional Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Additional Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../createMask/" class="md-nav__link">
      Creating Masks
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../customAnalysis/" class="md-nav__link">
      Customized Analyses
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../troubleshooting/" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    
    <label class="md-nav__link" for="nav-7">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../glossary/" class="md-nav__link">
      Glossary
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../imageOrientation/" class="md-nav__link">
      Image Orientation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneal-scanner-simulation-tools" class="md-nav__link">
    Pyneal Scanner Simulation Tools
  </a>
  
    <nav class="md-nav" aria-label="Pyneal Scanner Simulation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scanner-simulators" class="md-nav__link">
    Scanner Simulators
  </a>
  
    <nav class="md-nav" aria-label="Scanner Simulators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ge" class="md-nav__link">
    GE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#philips" class="md-nav__link">
    Philips
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siemens" class="md-nav__link">
    Siemens
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pynealreceiver_simpy" class="md-nav__link">
    pynealReceiver_sim.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneal-simulation-tools" class="md-nav__link">
    Pyneal Simulation Tools
  </a>
  
    <nav class="md-nav" aria-label="Pyneal Simulation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pynealscanner_simpy" class="md-nav__link">
    pynealScanner_sim.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pynealresults_simpy" class="md-nav__link">
    pynealResults_sim.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enduser_simpy" class="md-nav__link">
    endUser_sim.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="simulations">Simulations<a class="headerlink" href="#simulations" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In order to help with the initial setup, as well as test any analysis scripts and network communications later on, <strong>Pyneal</strong> includes a suite of simulation tools that mimic various inputs and outputs along the data flow path.</p>
<p>(To test your installation or analysis scripts using example data, download the <a href="https://github.com/jeffmacinnes/pyneal-tutorial"><strong>Pyneal Tutorial Data</strong></a>, which contains sample data from GE, Philips, and Siemens environments)</p>
<p>These tools allow you to simulate <strong>Pyneal</strong> (or <strong>Pyneal Scanner</strong>) in a modular fashion without having to run the entire pipeline. If you are troubleshooting issues, these tools are immensely helpful.  </p>
<p>Here is a diagram highlighting the various simulation tools, and where they enter the data flow pipeline. </p>
<p><img alt="" src="../images/simulation/simulationSchematic.png" /></p>
<p>During an actual real-time scan, data will flow through this diagram from left to right along the blue arrows. </p>
<p>Simulation tools are indicated using dashed or dotted vertical lines.</p>
<ul>
<li>
<p>A dashed line indicates a simulation tool that <strong>generates input</strong>. In other words, these tools mimic real data as it exists at a particular stage of the pipeline</p>
</li>
<li>
<p>A dotted line indicates a simulation tool that <strong>receives output</strong>. In other words, these tools allow you to simulate the <em>next</em> stage of the pipeline</p>
</li>
</ul>
<p>Both <strong>Pyneal Scanner</strong> and <strong>Pyneal</strong> have their own set of simulation tools. </p>
<ul>
<li>
<p><strong>Pyneal Scanner</strong> simulation tools can be found in <code>pyneal/pyneal_scanner/simulation</code> and are shown in light blue <em>below</em> the real data pipeline in the schematic. See below for more details</p>
</li>
<li>
<p><strong>Pyneal</strong> simulation tools can be found in <code>pyneal/utils/simulation</code> and are shown in green <em>above</em> the real data pipeline in the schematic. See below for more details</p>
</li>
</ul>
<h2 id="pyneal-scanner-simulation-tools">Pyneal Scanner Simulation Tools<a class="headerlink" href="#pyneal-scanner-simulation-tools" title="Permanent link">&para;</a></h2>
<p>The <strong>Pyneal Scanner</strong> simulation tools can be found in <code>pyneal/pyneal_scanner/simulation</code></p>
<ul>
<li><strong>Scanner Simulators</strong>: Set of simulation scripts to mimic the behavior of real scanners with real data. </li>
<li><strong>pynealReceiver_sim.py</strong>: simulates the behavior of <strong>Pyneal</strong> (i.e. accepts incoming 3D volumes from <strong>Pyneal Scanner</strong>)</li>
</ul>
<h3 id="scanner-simulators">Scanner Simulators<a class="headerlink" href="#scanner-simulators" title="Permanent link">&para;</a></h3>
<p><strong>Use Case:</strong> Testing <strong>Pyneal Scanner</strong> (and <em>anything else</em> downstream) with real data.</p>
<p><img alt="" src="../images/simulation/scannerSimulators.png" /></p>
<p>This will simulate the appearance of raw data coming off of the scanner. This works by pointing the simulator to a folder containing real scanner data. The simulator will copy the real data to a new directory in a way that mimics the behavior of a real scan, allowing you to test <strong>Pyneal Scanner</strong> and anything else downstream. </p>
<p>The format of the raw data will vary according to different scanner environments/manufacturers. Accordingly, there are multiple scripts that will simulate different scanner formats:</p>
<h4 id="ge">GE<a class="headerlink" href="#ge" title="Permanent link">&para;</a></h4>
<p><strong><em>location</em></strong>: <code>pyneal/pyneal_scanner/simulation/scannerSimulators/GE_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python GE_sim.py inputDir [--outputDir] [--TR]</code></p>
<p><strong><em>input args</em></strong>:  </p>
<ul>
<li>inputDir: path to directory containing raw slice dicom images. </li>
<li>-o outputDir: path to directory where slices will be copied to [default: create new directory named <code>s9999</code> in the parent directory of the inputDir]</li>
<li>-t/--TR TR: set the TR in ms [default: 1000]</li>
</ul>
<p>In order to run this script, you must have a local directory that contains raw slice dicom files from an actual scan. If you want to fully mimic the data directory structure of GE scanners, you can create a local directory path that follows the pattern <code>[baseDir]/p##/e##/s##</code> where the slice images are stored in a directory named like <code>s###</code>, which is nested two levels deep (<code>p###/e###</code>) from the <code>[basedir]</code>. </p>
<p>This script will copy all of the slices from the inputDir and copy them to the outputDir at a rate that is set by the TR. </p>
<p>After the script has completed, the outputDir will be deleted. </p>
<h4 id="philips">Philips<a class="headerlink" href="#philips" title="Permanent link">&para;</a></h4>
<p><strong><em>location</em></strong>: <code>pyneal/pyneal_scanner/simulation/scannerSimulators/Philips_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python Philips_sim.py inputDir [--outputDir] [--TR]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>inputDir: path to directory containing raw slice dicom images. </li>
<li>-o outputDir: path to directory where slices will be copied to [default: create new directory named <code>9999</code> in the parent directory of the inputDir]</li>
<li>-t/--TR TR: set the TR in ms [default: 1000]</li>
</ul>
<p>Philips scanners use XTC (eXTernal Control) to output reconstructed volumes to a directory during a scan. The files are written to a designated directory (e.g. XTC_Output), and within that directory, every series is assigned a new directory named sequentially starting with '0000'. For instance, volumes from the 3rd series will be stored like '.../XTC_Output/0002/'. This script will simulate the creation of a new series directory, and copy in PAR/REC files.</p>
<p>You must specify a local path to the inputDir. That is, the directory that already
contains a set of reconstructed PAR/REC files for a series (referred to below as <code>seriesDir</code>). </p>
<p>[OPTIONAL]: You can specify the full path to an output directory where the PAR/REC files
will be copied to. If you don't specify an output directory, this tool will default
to creating a new <code>seriesDir</code>, named '9999' saved in the parent directory of the <code>seriesDir</code>.</p>
<blockquote>
<p>python Philips_sim.py /Path/To/My/Existing/Series/0000 --outputDir /Where/I/Want/New/Slice/Data/To/appear</p>
</blockquote>
<p>if you did not specify an outputDir, new PAR/RECs would be copied to:</p>
<p><code>/Path/To/My/Existing/Series/9999</code></p>
<p>[OPTIONAL]: You can specify the TR at which new PAR/REC data is copied. Default is 1000ms.</p>
<blockquote>
<p>python Philips_sim.py /Path/To/My/Existing/Series/0000 --TR 2000</p>
</blockquote>
<h4 id="siemens">Siemens<a class="headerlink" href="#siemens" title="Permanent link">&para;</a></h4>
<p><strong><em>location</em></strong>: <code>pyneal/pyneal_scanner/simulation/scannerSimulators/Siemens_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python Siemens_sim.py inputDir seriesNum [--newSeriesNum] [--TR]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>inputDir: path to directory containing raw slice dicom images. </li>
<li>seriesNum: series number of data that you want to simulate</li>
<li>-n/--newSeriesNum: seriesNumber to assign to the new "simulated" data</li>
<li>-t/--TR: set the TR in ms [default: 1000]</li>
</ul>
<p>Siemens scanners stores reconstructed slices images by taking all of the slices for a single volume, and placing them side-by-side in a larger "mosaic" dicom image. A scan will produce one mosaic image per volume, and all mosaic images for all scans across a single session will be stored in the same directory. This script simulates the creation of that directory, and will pass in real mosaic images.</p>
<p>You must specify a local path to the inputDir as well as the series number of the series you want to simulate.</p>
<p>The input dir should be the directory that already contains a set of reconstructed mosaic images. A single session dir will hold all of the mosaic files for all of the scans for a given session. Mosaic files are named like:</p>
<p><code>[session#]_[series#]_[vol#].dcm</code></p>
<p>[OPTIONAL]: You can specify the series number that will be assigned to the "new" mosaic images. The default behavior is to assign a series number based on the next sequential number given the existing series. In the example below, the default would be to assign a newSeriesNum as '2', but we are overriding that to assign it as '19'</p>
<blockquote>
<p>python Siemens_sim.py /Path/To/My/Existing/inputDir 1 --newSeriesNum 19</p>
</blockquote>
<p>[OPTIONAL]: You can specify the TR at which new slice data is copied. Default is 1000ms, and represents the approximate amount of time it should take to copy over all of the slices for one volume of data.</p>
<blockquote>
<p>python Siemens_sim.py /Path/To/My/Existing/inputDir 1 --TR 2000</p>
</blockquote>
<h3 id="pynealreceiver_simpy">pynealReceiver_sim.py<a class="headerlink" href="#pynealreceiver_simpy" title="Permanent link">&para;</a></h3>
<p><strong>Use Case:</strong> When you want to test <strong>Pyneal Scanner</strong> without having to actually run <strong>Pyneal</strong></p>
<p><img alt="" src="../images/simulation/pynealReceiver.png" /></p>
<p>This simulator will mimic the part of <strong>Pyneal</strong> that accepts incoming 3D volumes from <strong>Pyneal Scanner</strong>. This allows you to quickly test sending output with <strong>Pyneal Scanner</strong>, without having to fully run <strong>Pyneal</strong> (which entails a lot of extra overhead). You can (and should) run <code>pynealReceiver_sim.py</code> from the <strong>Scanner Computer</strong>. </p>
<p><strong><em>location</em></strong>: <code>pyneal/pyneal_scanner/simulation/pynealReceiver_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python pynealReceiver_sim.py [--port] [--nVols]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>-p/--port: port number to listen on for incoming data [default: 5556]</li>
<li>-n/--nVols: number of 3D volumes to expect from <strong>Pyneal Scanner</strong> [default: 60]</li>
</ul>
<p>Make sure <strong>Pyneal Scanner</strong> is configured to use the same port number for <code>pynealSocketPort</code> (see <a href="/setup.md#pyneal-scanner"><strong>Pyneal Scanner Setup</strong></a>)</p>
<p>After the scan is complete and all of the data has arrived, this will save the received 4D volume as a nifti image at  <code>pyneal/pyneal_scanner/simulation/receivedImg.nii.gz</code></p>
<h2 id="pyneal-simulation-tools">Pyneal Simulation Tools<a class="headerlink" href="#pyneal-simulation-tools" title="Permanent link">&para;</a></h2>
<p>The <strong>Pyneal</strong> simulation tools can be found in <code>pyneal/utils/simulation</code></p>
<ul>
<li><strong>pynealScanner_sim.py</strong>: simulate the behavior of <strong>Pyneal Scanner</strong> (i.e. sends 3D vols to Pyneal) </li>
<li><strong>pynealResults_sim.py</strong>: simulate the results server of <strong>Pyneal</strong> (i.e. launches a server that stores fake results that can receive and respond to messages from the <strong>End User</strong>)</li>
<li><strong>endUser_sim.py</strong>: simulate the behavior of an <strong>End User</strong> (i.e. sends request to <strong>Pyneal</strong> for results from a specific volume, then waits for response)</li>
</ul>
<h3 id="pynealscanner_simpy">pynealScanner_sim.py<a class="headerlink" href="#pynealscanner_simpy" title="Permanent link">&para;</a></h3>
<p><strong>Use Case:</strong> When you want to test <strong>Pyneal</strong> without having to actually run <strong>Pyneal Scanner</strong></p>
<p><img alt="" src="../images/simulation/pynealScanner.png" /></p>
<p><strong><em>location</em></strong>: <code>pyneal/utils/simulation/pynealScanner_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python pynealScanner_sim.py [--filePath] [--random] [--dims] [--TR] [--sockethost] [--socketport]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>-f/--filePath: path to 4D nifti image that you want to use as the "scan" data</li>
<li>-r/--random: flag to generate random data instead of using a pre-existing nifti image </li>
<li>-d/--dims: desired dimensions of randomly generated dataset [default: 64 64 18 60] </li>
<li>-t/--TR: set the TR in ms [default: 1000]</li>
<li>-sh/--sockethost: IP address Pyneal host [default: 127.0.0.1]</li>
<li>-sp/--socketport: port number to send 3D volumes over to Pyneal [default: 5555]</li>
</ul>
<p>This tool will simulate the behavior of <strong>Pyneal Scanner</strong>. During a real scan, pynealScanner will send data to pyneal over a socket connection. Each tranmission comes in 2 phases: first a json header with metadata about the volume, then the volume itself. This tool will send data in that same format, using either a pre-existing 4D nifti image, or randomly generated data.</p>
<p>You can either supply real 4D image data:</p>
<blockquote>
<p>python pynealScanner_sim.py --filePath /path/to/my/data.nii.gz</p>
</blockquote>
<p>or use the tool to generate a dataset of random values</p>
<blockquote>
<p>python pynealScanner_sim.py --random --dims 64 64 32 100 </p>
</blockquote>
<p>[OPTIONAL]: You can specify the TR at which 3D vols are sent to <strong>Pyneal</strong>. Default is 1000ms.</p>
<blockquote>
<p>python pynealScanner_sim.py --filePath /path/to/my/data.nii.gz --TR 2000</p>
</blockquote>
<p>[OPTIONAL]: You can set the socketHost and socketPort used for communication with <strong>Pyneal</strong>. Default host is <code>127.0.0.1</code>, which allows you to run this tool alongside <strong>Pyneal</strong> on the same computer. Default socket port number is <code>5555</code>. You must make sure that <strong>Pyneal</strong> is configured to be listening for incoming data on this port number (see <a href="../setup/#pyneal"><strong>Pyneal Set Up</strong></a>)</p>
<h3 id="pynealresults_simpy">pynealResults_sim.py<a class="headerlink" href="#pynealresults_simpy" title="Permanent link">&para;</a></h3>
<p><strong>Use Case:</strong> When you want to test an <strong>End User</strong> without having to actually run <strong>Pyneal</strong> (or anything else further upstream)</p>
<p><img alt="" src="../images/simulation/pynealResults.png" /></p>
<p><strong><em>location</em></strong>: <code>pyneal/utils/simulation/pynealResults_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python pynealResults_sim.py [--TR] [--sockethost] [--socketport] [--keepAlive]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>-t/--TR: set the TR in ms [default: 1000]</li>
<li>-sh/--sockethost: IP address Pyneal host [default: 127.0.0.1]</li>
<li>-sp/--socketport: port number to send 3D volumes over to Pyneal [default: 5556]</li>
<li>--keepAlive: True/False flag for whether to keep the simulated server alive and listening even once all of the made up data is added to it (see below for more details). Useful for debugging/testing. [default: False]</li>
</ul>
<p>This tool will launch a server that listen in for requests for results from a remote <strong>End User</strong> (e.g. a task presentation machine). This tools behaves exactly the same way as the results server component of Pyneal, allowing you to test the <strong>End User</strong> behavior.</p>
<p>In this case the results that are returned are from a made up dataset generated each time the tool is called. There are 500 volumes in the generated dataset, and each volume has an associated "Average" result that is a random value drawn from a normal distribution (mean: 2400, stdDev: 15). Results for each volume will be available on the simulated results server at a rate set by the TR. For instance, with a 1000ms TR, it will take 500s for all of the results to appear. </p>
<p>While this simulated results server is running, it will listen for requests from an <strong>End User</strong>. With each request that appears, it will check to see if the result from the requested volume has appeared yet. If it has, it will send back a message that looks something like:</p>
<p><code>{foundResults: True, average: #####}</code></p>
<p>If not, the response message will simply be:</p>
<p><code>{foundResults: False}</code></p>
<p>For more information on formatting requests and interpretting responses, see <a href="../endUser/#sending-requests"><strong>requesting results</strong></a>)</p>
<h3 id="enduser_simpy">endUser_sim.py<a class="headerlink" href="#enduser_simpy" title="Permanent link">&para;</a></h3>
<p><strong>Use Case:</strong> When you want to test sending requests to <strong>Pyneal</strong> without having to actually run a real <strong>End User</strong> </p>
<p><img alt="" src="../images/simulation/endUser.png" /></p>
<p><strong><em>location</em></strong>: <code>pyneal/utils/simulation/endUser_sim.py</code></p>
<p><strong><em>usage</em></strong>: <code>python endUser_sim.py [-sh/--socketHost] [-sp/--socketPort] [volIdx]</code></p>
<p><strong><em>input args</em></strong>:</p>
<ul>
<li>-sh/--sockethost: IP address Pyneal host [default: '127.0.0.1']</li>
<li>-sp/--socketport: port number to send 3D volumes over to Pyneal [default: 5556]</li>
<li>volIdx: the index of the volume you'd like to request results from [default: 0000]. Note: volume indices are 0-based</li>
</ul>
<p>This tool will simulate and demo how an <strong>End User</strong> may request results from <strong>Pyneal</strong>
during a real-time scan.</p>
<p>In a neurofeedback context, for example, the end-user may be the software that is controlling the experimental task. In this case, anytime the task wants to present feedback to the participant, it must request the output of the real-time analysis for a specific set of timepoints (or volumes).</p>
<p>This is an example of how requests should be formatted and sent to <strong>Pyneal</strong>. Requests are made on a per-volume basis, and each request should take the form of a 4-character string representing the desired volume index (using a 0-based index). For example, to request the first volume in the series, the string would be '0000'; to request the 25th volume in the series the string would be '0024', and so on...</p>
<p>For more information on formatting requests and interpretting responses, see <a href="../endUser/#sending-requests"><strong>requesting results</strong></a> and <a href="../endUser/#parsing-responses"><strong>parsing responses</strong></a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../endUser/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                End User
              </div>
            </div>
          </a>
        
        
          <a href="../createMask/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Creating Masks
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/jeffmacinnes/pyneal" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>